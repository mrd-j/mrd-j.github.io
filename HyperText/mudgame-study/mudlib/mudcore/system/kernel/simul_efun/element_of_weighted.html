<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd" >
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet" type="text/css" href="/interrupter/myStyle.css"></link>
    <script type="text/javascript" src="/js/myScript.js"></script>
</head>
<body>
<pre>
/**
 * NAME: element_of_weighted
 * SYNOPSIS: mixed element_of_weighted( mapping data )
 * DESCRIPTION: Returns a property from a mapping weighted by its value.
 * The higher the weight (value), the more likely it will be returned.
 * EXAMPLE: element_of_weighted( ([ "element1" : 10, "element2" : 5 ]) )
 * Return value will more likely be "element1" due to its higher weight.
 * DEPENDENCIES: sum
 */

mixed element_of_weighted(mapping data)
{
    int roll_result, next_position, weight, max_weight;
    mixed *elems = ({ }), elem;
    int *weights = ({ }), *indices = ({ }), index = 0;

    foreach(elem, weight in data)
    {
        elems   = ({ elems..., elem });
        weights = ({ weights..., weight });
        indices = ({ indices..., index++ });
    }

    indices       = shuffle(indices);
    next_position = 0;
    max_weight    = CORE_SIMUL_EFUN_OB->sum(weights...);
    roll_result   = random(max_weight);

    foreach(index in indices)
    {
        //get that element's weight
        weight = weights[index];

        //our next_position is the point at which our next element
        //will be available.
        next_position += weight;

        //if our random number (roll_result) falls before our next_position
        //then that's our guy.
        if(roll_result < next_position) return elems[index];
    }
}






























</pre>
</body>
</html>
